
<table class="table table-dark table-bordered table-hover align-middle">
  <thead class="table-light sticky-head">
    <tr>
      <th class="time-col sticky-col">เวลา</th>
      {% for c in comps %}
        <th class="slot text-center">
          <div class="machine-head">
            <div class="fw-bold">{{ c.name }}</div>
            <div class="spec"><i class="bi bi-cpu"></i> {{ c.spec }}</div>
          </div>
        </th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for h in hours %}
      <tr>
        <th class="time-col sticky-col">{{ h.strftime('%H:00') }}</th>
        {% for c in comps %}
          {% set items = [] %}
          {% for b in by_comp.get(c.id, []) %}
            {% if b.start_at <= h < b.end_at %}
              {% set _ = items.append(b) %}
            {% endif %}
          {% endfor %}
          <td>
            {% for b in items %}
              {% set hue = (b.customer|length * 41) % 360 %}
              <span class="badge-book" style="background:linear-gradient(90deg, hsl({{hue}},85%,46%), hsl({{(hue+45)%360}},85%,42%));">
                <i class="bi bi-person-fill"></i> {{ b.customer }}
                <small class="opacity-75">({{ b.start_at.strftime('%H:%M') }}‑{{ b.end_at.strftime('%H:%M') }})</small>
              </span>
              {% if session.get('admin_logged_in') %}
              <form method="post" action="{{ url_for('delete_booking', bid=b.id) }}" class="d-inline">
                <button class="btn btn-sm btn-outline-light border-0 ms-1" onclick="return confirm('ลบการจองนี้?')"><i class="bi bi-trash3"></i></button>
              </form>
              {% endif %}
            {% endfor %}
          </td>
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>
